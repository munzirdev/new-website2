# 🤖 دليل إعداد بوت التلقرام للشات بوت

## 📋 نظرة عامة

تم ربط الشات بوت مع بوت تلقرام لإرسال إشعارات فورية للمشرفين عند:
- طلب العميل التحدث مع ممثل خدمة عملاء
- وصول رسائل جديدة
- وصول رسائل مستعجلة

## 🚀 الإعداد السريع

### الخطوة 1: إنشاء بوت تلقرام

1. **اذهب إلى @BotFather في تلقرام**
2. **اكتب `/newbot`**
3. **اتبع التعليمات وأعطِ اسماً للبوت**
4. **احصل على رمز البوت (Bot Token)**

### الخطوة 2: الحصول على معرف المحادثة

1. **ابدأ محادثة مع البوت الجديد**
2. **اذهب إلى @userinfobot**
3. **اكتب أي رسالة**
4. **احفظ معرف المحادثة (Chat ID)**

### الخطوة 3: إعداد قاعدة البيانات

```sql
-- تشغيل ملف SQL في Supabase
-- يمكنك نسخ محتوى ملف supabase/migrations/20240115000000_create_telegram_config.sql
-- وتشغيله في SQL Editor في Supabase
```

### الخطوة 4: تشغيل التطبيق

```bash
# تثبيت التبعيات
npm install

# تشغيل التطبيق
npm run dev
```

### الخطوة 5: إعداد البوت في الواجهة

1. **اذهب إلى لوحة التحكم**
2. **اختر "إعدادات التلقرام"**
3. **أدخل رمز البوت ومعرف المحادثة**
4. **فعّل البوت**
5. **اختبر الاتصال**

## 🔧 الأوامر المتاحة

### في التلقرام
- `/status` - حالة البوت
- `/sessions` - الجلسات النشطة
- `/help` - المساعدة

### في Terminal
```bash
# تشغيل البوت
npm run telegram-bot

# تشغيل في وضع التطوير
npm run telegram-bot:dev

# إيقاف البوت
Ctrl + C
```

## 📱 أنواع الإشعارات

### 🚨 طلب ممثل خدمة عملاء
```
🚨 طلب ممثل خدمة عملاء جديد

👤 معلومات العميل:
• الاسم: أحمد محمد
• البريد الإلكتروني: ahmed@example.com
• رقم الهاتف: +966501234567
• البلد: Saudi Arabia

💬 آخر رسالة:
أريد التحدث مع ممثل حقيقي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-001
• عدد الرسائل: 3
• الأولوية: 🚨 مستعجل
• اللغة: العربية

⏰ التوقيت:
2024-01-15 14:30:25
```

### 💬 رسالة جديدة
```
💬 رسالة جديدة من العميل

👤 العميل: أحمد محمد

💬 الرسالة:
مشكلة في التأمين الصحي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-002
• عدد الرسائل: 5

⏰ التوقيت:
2024-01-15 14:35:10
```

### 🚨 رسالة مستعجلة
```
🚨 رسالة مستعجلة!

👤 العميل: أحمد محمد

💬 الرسالة المستعجلة:
مشكلة عاجلة في التأمين الصحي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-003
• الأولوية: 🚨 مستعجل
• عدد الرسائل: 8

⏰ التوقيت:
2024-01-15 14:40:15

⚠️ هذه رسالة مستعجلة تتطلب رداً فورياً!
```

## 🔘 الأزرار التفاعلية

### للرد على العميل
- **👨‍💼 الرد على العميل**: للرد المباشر على العميل
- **📋 عرض التفاصيل**: لعرض تفاصيل الجلسة الكاملة

### للرسائل الجديدة
- **💬 الرد السريع**: للرد السريع على العميل

### للرسائل المستعجلة
- **🚨 رد عاجل**: للرد العاجل على العميل
- **📞 الاتصال بالعميل**: للاتصال المباشر بالعميل

## 🔒 الأمان

### حماية رموز البوت
- رموز البوت مشفرة في قاعدة البيانات
- اتصالات HTTPS فقط
- صلاحيات محدودة للمستخدمين
- حماية من Rate Limiting

### تشفير البيانات
- جميع البيانات الحساسة مشفرة
- الاتصالات تتم عبر HTTPS
- رموز البوت محمية في قاعدة البيانات

## 🆘 استكشاف الأخطاء

### البوت لا يعمل
```bash
# تحقق من الإعدادات
npm run telegram-bot

# تحقق من السجلات
tail -f logs/telegram-bot.log
```

### الإشعارات لا تصل
1. تحقق من تفعيل البوت
2. تحقق من صحة الرمز ومعرف المحادثة
3. تأكد من بدء محادثة مع البوت

### أخطاء شائعة
- **"Bot token is invalid"** - رمز البوت خطأ
- **"Chat not found"** - معرف المحادثة خطأ
- **"Bot was blocked"** - ألغِ حظر البوت

### رسائل الخطأ
- **"Bot token is invalid"**: رمز البوت غير صحيح
- **"Chat not found"**: معرف المحادثة غير صحيح
- **"Bot was blocked"**: البوت محظور، ألغِ الحظر

## 📞 الدعم

للمساعدة في إعداد بوت التلقرام:
- راجع هذا الدليل
- تحقق من سجلات الأخطاء
- اتصل بفريق الدعم التقني

## 🔄 التحديثات المستقبلية

### المميزات المخططة
- [ ] دعم الرسائل الصوتية
- [ ] إرسال ملفات مرفقة
- [ ] دعم المجموعات والقنوات
- [ ] إحصائيات مفصلة
- [ ] قوالب رسائل مخصصة
- [ ] جدولة الرسائل
- [ ] دعم لغات إضافية

## 📁 هيكل الملفات

```
src/
├── components/
│   ├── TelegramSettings.tsx      # واجهة إعدادات التلقرام
│   └── AdminChatSupport.tsx      # نظام إدارة الشات
├── services/
│   └── telegramService.ts        # خدمة التلقرام
├── config/
│   └── telegram.ts               # إعدادات التلقرام
└── ...

server/
└── telegramBot.js                # خادم بوت التلقرام

database/
└── telegram_config.sql           # جدول إعدادات التلقرام

docs/
└── telegram-bot-setup.md         # دليل الإعداد
```

## 🎯 المميزات الرئيسية

### ✅ إشعارات فورية
- عند طلب العميل التحدث مع ممثل
- عند وصول رسائل جديدة
- عند وصول رسائل مستعجلة

### ✅ رسائل تفاعلية
- أزرار للرد السريع
- عرض تفاصيل الجلسة
- إمكانية الاتصال بالعميل

### ✅ واجهة إدارة متقدمة
- إعدادات شاملة
- اختبار الاتصال
- مراقبة حالة البوت

### ✅ أمان عالي
- تشفير رموز البوت
- حماية البيانات
- صلاحيات محدودة

---

**🎉 البوت جاهز للعمل!**

للبدء، اتبع الخطوات أعلاه وستتمكن من استقبال إشعارات تلقرام فورية عند طلب العملاء التحدث مع ممثل خدمة عملاء.
