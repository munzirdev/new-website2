# ุฏููู ุฅุนุฏุงุฏ ุฎุฏูุฉ Polling ููุชูููุฌุฑุงู

## ูุง ูู Pollingุ

**Polling** ูู ุชูููุฉ ูุฌูุจ ุงูุจูุงูุงุช ูู ุงูุชูููุฌุฑุงู ุจุดูู ุฏูุฑู ุจุฏูุงู ูู ุงูุชุธุงุฑ webhook. ูุฐุง ุงูุญู ูุนูู ูุน Supabase Edge Functions ุจุฏูู ุงูุญุงุฌุฉ ูุฎุฏูุงุช ุฎุงุฑุฌูุฉ.

## ุงููุฒุงูุง

โ **ูุฌุงูู ุชูุงูุงู** - ูุง ูุญุชุงุฌ ุฎุฏูุงุช ุฎุงุฑุฌูุฉ  
โ **ูุนูู ูุน Supabase** - ูุง ูุดุงูู ูุน Authorization  
โ **ุณูู ุงูุฅุนุฏุงุฏ** - ุฎุทูุงุช ุจุณูุทุฉ  
โ **ููุซูู** - ูุง ูุนุชูุฏ ุนูู ุฎุฏูุงุช ุฃุฎุฑู  

## ุงููุชุทูุจุงุช

- Node.js ูุซุจุช
- ููู `.env` ูุญุชูู ุนูู ูุชุบูุฑุงุช Supabase
- ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1. ุงูุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู

```bash
# ุชุดุบูู ุณูุฑูุจุช ุฅุนุฏุงุฏ ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู
node setup-telegram-config.js
```

### 2. ุงุฎุชุจุงุฑ ุฎุฏูุฉ Polling

```bash
# ุงุฎุชุจุงุฑ ุฌููุน ุงูููููุงุช
node test-polling-service.js
```

### 3. ุชุดุบูู ุฎุฏูุฉ Polling

```bash
# ุชุดุบูู ุงูุฎุฏูุฉ
node telegram-polling-service.js
```

## ููู ุชุนูู ุงูุฎุฏูุฉ

### ุขููุฉ ุงูุนูู

1. **ุฌูุจ ุงูุชุญุฏูุซุงุช**: ูู 10 ุซูุงูุ ุชุทูุจ ุงูุฎุฏูุฉ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู ุงูุชูููุฌุฑุงู
2. **ูุนุงูุฌุฉ Callback Queries**: ุนูุฏ ุงูุนุซูุฑ ุนูู callback query (ุฒุฑ "ุชู ุงูุชุนุงูู ูุนู")
3. **ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ูู ุงูุฌุฏุงูู ุงูููุงุณุจุฉ
4. **ุฅุฑุณุงู Feedback**: ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฃููุฏ ูููุฏูุฑ
5. **ุชุญุฏูุซ ุฑุณุงูุฉ ุงูุชูููุฌุฑุงู**: ุชุนุฏูู ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ ูุชุธูุฑ "ุชู ุงูุชุนุงูู ูุนู"

### ุงูุฌุฏุงูู ุงููุฏุนููุฉ

- `health_insurance_requests` - ุทูุจุงุช ุงูุชุฃููู ุงูุตุญู
- `service_requests` - ุทูุจุงุช ุงูุฎุฏูุฉ
- `voluntary_return_forms` - ุทูุจุงุช ุงูุนูุฏุฉ ุงูุทูุนูุฉ

### ุงูุฅุฌุฑุงุกุงุช ุงููุฏุนููุฉ

- `mark_resolved` - ุชู ุงูุชุนุงูู ูุนู
- `view_request` - ุนุฑุถ ุงูุทูุจ
- `contact_user` - ุงูุชูุงุตู ูุน ุงูุนููู
- `already_resolved` - ุชู ุงูุชุนุงูู ูุนู ูุณุจูุงู

## ุชุดุบูู ุงูุฎุฏูุฉ

### ูู ุจูุฆุฉ ุงูุชุทููุฑ

```bash
# ุชุดุบูู ูุจุงุดุฑ
node telegram-polling-service.js
```

### ูู ุงูุฅูุชุงุฌ

```bash
# ุชุดุบูู ูู ุงูุฎูููุฉ
nohup node telegram-polling-service.js > polling.log 2>&1 &

# ุฃู ุงุณุชุฎุฏุงู PM2
pm2 start telegram-polling-service.js --name "telegram-polling"
```

## ูุฑุงูุจุฉ ุงูุฎุฏูุฉ

### ุณุฌูุงุช ุงูุชุดุบูู

ุงูุฎุฏูุฉ ุชุทุจุน ุฑุณุงุฆู ููุตูุฉ ุนู:
- ุฌูุจ ุงูุชุญุฏูุซุงุช
- ูุนุงูุฌุฉ callback queries
- ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุฑุณุงู feedback

### ูุซุงู ุนูู ุงูุณุฌูุงุช

```
๐ ุจุฏุก ุฎุฏูุฉ polling ููุชูููุฌุฑุงู...
โฐ ุณูุชู ูุญุต ุงูุชุญุฏูุซุงุช ูู 10 ุซูุงู
๐ ุฌูุจ ุชุญุฏูุซุงุช ุงูุชูููุฌุฑุงู...
๐ญ ูุง ุชูุฌุฏ ุชุญุฏูุซุงุช ุฌุฏูุฏุฉ
๐ ุฌูุจ ุชุญุฏูุซุงุช ุงูุชูููุฌุฑุงู...
๐จ ุชู ุฌูุจ 1 ุชุญุฏูุซุงุช
๐ ูุนุงูุฌุฉ update_id: 123456789
๐ ูุนุงูุฌุฉ callback query: mark_resolved:abc123
๐ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ: abc123 -> resolved
โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุทูุจ ุงูุชุฃููู ุงูุตุญู
โ ุชู ุฅุฑุณุงู feedback ุจูุฌุงุญ
โ ุชู ุชุญุฏูุซ ุฑุณุงูุฉ ุงูุชูููุฌุฑุงู ุจูุฌุงุญ
โ ุชู ูุนุงูุฌุฉ callback query: mark_resolved
```

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

1. **ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู ููููุฏุฉ**
   ```bash
   node setup-telegram-config.js
   ```

2. **Bot Token ุบูุฑ ุตุญูุญ**
   - ุชุญูู ูู ุตุญุฉ Bot Token ูู ููู `.env`
   - ุชุฃูุฏ ูู ุฃู ุงูุจูุช ููุนู

3. **Admin Chat ID ุบูุฑ ุตุญูุญ**
   - ุชุฃูุฏ ูู ุฅุถุงูุฉ ุงูุจูุช ูููุฌููุนุฉ
   - ุชุญูู ูู ุตุญุฉ Chat ID

4. **ูุดุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
   - ุชุญูู ูู ุตุญุฉ ูุชุบูุฑุงุช Supabase
   - ุชุฃูุฏ ูู ูุฌูุฏ ุงูุฌุฏุงูู ุงููุทููุจุฉ

### ุงุฎุชุจุงุฑ ุงูุงุชุตุงู

```bash
# ุงุฎุชุจุงุฑ ุดุงูู
node test-polling-service.js
```

## ุฅููุงู ุงูุฎุฏูุฉ

### ูู ุจูุฆุฉ ุงูุชุทููุฑ
```bash
# Ctrl+C ูุฅููุงู ุงูุฎุฏูุฉ
```

### ูู ุงูุฅูุชุงุฌ
```bash
# ุฅุฐุง ุชู ุชุดุบูููุง ุจู nohup
pkill -f "telegram-polling-service.js"

# ุฅุฐุง ุชู ุชุดุบูููุง ุจู PM2
pm2 stop telegram-polling
```

## ุงูุชุฎุตูุต

### ุชุบููุฑ ูุชุฑุฉ Polling

```javascript
// ูู ููู telegram-polling-service.js
const POLLING_INTERVAL = 5000; // 5 ุซูุงู ุจุฏูุงู ูู 10
```

### ุฅุถุงูุฉ ุฅุฌุฑุงุกุงุช ุฌุฏูุฏุฉ

```javascript
// ูู ุฏุงูุฉ processCallbackQuery
switch (action) {
  case 'new_action':
    // ูุนุงูุฌุฉ ุงูุฅุฌุฑุงุก ุงูุฌุฏูุฏ
    break;
  // ... ุจุงูู ุงูุฅุฌุฑุงุกุงุช
}
```

## ุงูุฃูุงู

- ุงูุฎุฏูุฉ ุชุณุชุฎุฏู `SUPABASE_SERVICE_ROLE_KEY` ูููุตูู ููุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุง ุชุดุงุฑู Bot Token ุฃู Service Role Key
- ุงุญุชูุธ ุจููู `.env` ุขููุงู

## ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู ุณุฌูุงุช ุงูุชุดุบูู
2. ุดุบู `test-polling-service.js`
3. ุชุฃูุฏ ูู ุตุญุฉ ุงูุฅุนุฏุงุฏุงุช
4. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช

## ุงูุฎูุงุตุฉ

ุฎุฏูุฉ Polling ูู ุงูุญู ุงูุฃูุซู ููุดููุฉ ุฒุฑ "ุชู ุงูุชุนุงูู ูุนู" ูู ุงูุชูููุฌุฑุงู. ุฅููุง:
- ูุฌุงููุฉ ูููุชูุญุฉ ุงููุตุฏุฑ
- ุชุนูู ูุน Supabase ุจุฏูู ูุดุงูู
- ุณููุฉ ุงูุฅุนุฏุงุฏ ูุงูุตูุงูุฉ
- ููุซููุฉ ููุนุงูุฉ
