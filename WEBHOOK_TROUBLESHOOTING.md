# ุญู ูุดููุฉ ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ - Telegram Webhook

## ุงููุดููุฉ
ุงูุฅุดุนุงุฑุงุช ูุง ุฒุงูุช ุชุธูุฑ ุจุงูุดูู ุงููุฏูู ุจุฏูุงู ูู ุงูุชุตููู ุงูุฌุฏูุฏ ุญุณุจ ููุน ุงูุฎุฏูุฉ.

## ุงูุฃุณุจุงุจ ุงููุญุชููุฉ

### 1. Edge Function ูู ูุชู ุชุญุฏูุซู
- ุงูุชุญุฏูุซุงุช ูู ูุชู ูุดุฑูุง ูู Supabase
- ุงูููุฏ ุงููุฏูู ูุง ุฒุงู ูุนูู

### 2. ูุดููุฉ ูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ
- ุงูุจูุงูุงุช ูุง ุชุญุชูู ุนูู `additionalData`
- `serviceType` ุบูุฑ ููุฌูุฏ ุฃู ุฎุงุทุฆ

### 3. ูุดููุฉ ูู ุงูุชุฎุฒูู ุงููุคูุช
- ุงููุชุตูุญ ูุญุชูุธ ุจุงูููุฏ ุงููุฏูู
- Supabase ูุญุชูุธ ุจุงููุณุฎุฉ ุงููุฏููุฉ

## ุงูุญููู

### 1. ุฅุนุงุฏุฉ ูุดุฑ Edge Function
```bash
# ูู ูุฌูุฏ ุงููุดุฑูุน
supabase functions deploy telegram-webhook
```

### 2. ูุญุต ุณุฌูุงุช Edge Function
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู Edge Functions
4. ุงุฎุชุฑ `telegram-webhook`
5. ุงุฐูุจ ุฅูู Logs
6. ุชุญูู ูู ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ

### 3. ุงุฎุชุจุงุฑ ุงูููุจููู ูุจุงุดุฑุฉ
```bash
# ุชุดุบูู ุณูุฑูุจุช ุงูุงุฎุชุจุงุฑ
node test-webhook.js
```

### 4. ูุญุต ุงูุจูุงูุงุช ุงููุฑุณูุฉ
ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุชุญุชูู ุนูู:
```javascript
{
  sessionId: 'unique-id',
  message: 'ุชูุงุตูู ุงูุทูุจ',
  language: 'ar',
  requestType: 'translation', // ุฃู 'service_request'
  userInfo: {
    name: 'ุงุณู ุงูุนููู',
    email: 'email@example.com',
    phone: '+966501234567'
  },
  additionalData: {
    serviceType: 'translation', // ููุน ุงูุฎุฏูุฉ
    hasFile: false,
    fileName: null
  },
  requestId: 'unique-request-id'
}
```

## ุฎุทูุงุช ุงูุชุดุฎูุต

### 1. ูุญุต ุณุฌูุงุช ุงููุชุตูุญ
1. ุงูุชุญ Developer Tools (F12)
2. ุงุฐูุจ ุฅูู Console
3. ุงุจุญุซ ุนู ุฑุณุงุฆู ุชุจุฏุฃ ุจู:
   - `๐ sendServiceRequestNotification called with:`
   - `๐ ุจุฏุก ุฅุฑุณุงู ุฅุดุนุงุฑ ุทูุจ ูุน ููู ุนุจุฑ Edge Function...`
   - `๐ Webhook request received:`

### 2. ูุญุต ุณุฌูุงุช Supabase
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. Edge Functions > telegram-webhook > Logs
3. ุงุจุญุซ ุนู ุฑุณุงุฆู ุชุจุฏุฃ ุจู:
   - `๐ Webhook request received:`
   - `๐ Formatting message with data:`

### 3. ุงุฎุชุจุงุฑ ูุจุงุดุฑ
```javascript
// ูู console ุงููุชุตูุญ
const testData = {
  sessionId: 'test-' + Date.now(),
  message: 'ุงุฎุชุจุงุฑ ุงูุชุตููู ุงูุฌุฏูุฏ',
  language: 'ar',
  requestType: 'service_request',
  userInfo: {
    name: 'ูุณุชุฎุฏู ุชุฌุฑูุจู',
    email: 'test@example.com',
    phone: '+966501234567'
  },
  additionalData: {
    serviceType: 'legal_services',
    hasFile: false,
    fileName: null
  },
  requestId: 'test-' + Date.now()
};

// ุงุณุชุฏุนุงุก ุงูููุจููู ูุจุงุดุฑุฉ
supabase.functions.invoke('telegram-webhook', { body: testData })
  .then(({ data, error }) => {
    if (error) {
      console.error('โ ุฎุทุฃ:', error);
    } else {
      console.log('โ ูุฌุญ:', data);
    }
  });
```

## ุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช

### 1. ูุญุต Edge Function
```bash
# ุนุฑุถ ูุญุชูู ุงูููู ุงููุญูู
cat supabase/functions/telegram-webhook/index.ts | grep -A 5 -B 5 "getServiceTypeText"
```

### 2. ูุญุต ุงูุฅุตุฏุงุฑ
```bash
# ุนุฑุถ ุขุฎุฑ ุชุญุฏูุซ
git log --oneline -10
```

### 3. ุฅุนุงุฏุฉ ุจูุงุก ุงููุดุฑูุน
```bash
# ุฅุนุงุฏุฉ ุจูุงุก ุงููุดุฑูุน
npm run build
# ุฃู
yarn build
```

## ุงูุฅุดุนุงุฑุงุช ุงููุชููุนุฉ

### ุทูุจ ุชุฑุฌูุฉ:
```
๐ ุทูุจ ุชุฑุฌูุฉ ุฌุฏูุฏ

๐ค ูุนูููุงุช ุงูุนููู:
โข ุงูุงุณู: ุฃุญูุฏ ูุญูุฏ
โข ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: ahmed@example.com
โข ุฑูู ุงููุงุชู: +966501234567

๐ ุชูุงุตูู ุงูุทูุจ:
ุฃุญุชุงุฌ ุชุฑุฌูุฉ ูุซููุฉ ูู ุงูุนุฑุจูุฉ ุฅูู ุงูุฅูุฌููุฒูุฉ

๐ ูุนูููุงุช ุฅุถุงููุฉ:
โข ููุน ุงูุฎุฏูุฉ: ุชุฑุฌูุฉ
โข ุงูุฃููููุฉ: ๐ก ูุชูุณุท
โข ุงูุญุงูุฉ: ูุนูู

๐ ุชูุงุตูู ุงูุชุฑุฌูุฉ:
โข ููู ูุฑูู: document.pdf

๐ ูุนุฑู ุงูุทูุจ: 1234567890
```

### ุทูุจ ุฎุฏูุฉ ุนุงูุฉ:
```
๐ ุทูุจ ุฎุฏูุฉ ุฌุฏูุฏ

๐ค ูุนูููุงุช ุงูุนููู:
โข ุงูุงุณู: ูุงุทูุฉ ุฃุญูุฏ
โข ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: fatima@example.com
โข ุฑูู ุงููุงุชู: +966509876543

๐ ุชูุงุตูู ุงูุทูุจ:
ุฃุญุชุงุฌ ุงุณุชุดุงุฑุฉ ูุงููููุฉ

๐ ูุนูููุงุช ุฅุถุงููุฉ:
โข ููุน ุงูุฎุฏูุฉ: ุฎุฏูุงุช ูุงููููุฉ
โข ุงูุฃููููุฉ: ๐ก ูุชูุณุท
โข ุงูุญุงูุฉ: ูุนูู

๐ ุชูุงุตูู ุงูุฎุฏูุฉ:
โข ููุน ุงูุฎุฏูุฉ: ุฎุฏูุงุช ูุงููููุฉ

๐ ูุนุฑู ุงูุทูุจ: 1234567891
```

## ุฅุฐุง ูู ุชุนูู ุงูุญููู

### 1. ุฅุนุงุฏุฉ ุฅูุดุงุก Edge Function
```bash
# ุญุฐู ูุฅุนุงุฏุฉ ุฅูุดุงุก
supabase functions delete telegram-webhook
supabase functions new telegram-webhook
# ุซู ูุณุฎ ุงูููุฏ ุงูุฌุฏูุฏ
```

### 2. ูุญุต ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู
1. ุชุฃูุฏ ูู ุฃู ุงูุจูุช ููุนู
2. ุชุฃูุฏ ูู ุตุญุฉ ูุนุฑูุงุช ุงูุจูุช ูุงููุญุงุฏุซุฉ
3. ุงุฎุชุจุฑ ุงูุงุชุตุงู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

### 3. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ูุญุต ุฅุนุฏุงุฏุงุช ุงูุชูููุฌุฑุงู
SELECT * FROM telegram_config WHERE id = 2;

-- ูุญุต ุขุฎุฑ ุงูุทูุจุงุช
SELECT * FROM service_requests ORDER BY created_at DESC LIMIT 5;
```

## ููุงุญุธุงุช ูููุฉ

1. **ุฅุนุงุฏุฉ ูุดุฑ Edge Function ุถุฑูุฑู**: ุงูุชุญุฏูุซุงุช ูุง ุชุทุจู ุชููุงุฆูุงู
2. **ูุญุต ุงูุณุฌูุงุช ููู**: ููุนุฑูุฉ ูุง ูุญุฏุซ ุจุงูุถุจุท
3. **ุงุฎุชุจุงุฑ ูุจุงุดุฑ ูููุฏ**: ูุชุฃููุฏ ุฃู ุงููุดููุฉ ูู ุงูููุฏ ูููุณ ูู ุงูุจูุงูุงุช
4. **ูุณุญ ุงูุชุฎุฒูู ุงููุคูุช**: ูุฏ ูููู ุถุฑูุฑูุงู ูู ุจุนุถ ุงูุญุงูุงุช
